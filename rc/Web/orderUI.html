<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Drone Delivery</title>
  <style>
    :root {
      --bg: #f7f7f8;
      --card: #fff;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --border: #e5e7eb;
      --danger: #ef4444;
      --ok: #16a34a;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; color: var(--text); background: var(--bg); }
    .container { max-width: 1120px; margin: 0 auto; padding: 16px; }

    /* Header */
    header { position: sticky; top: 0; z-index: 40; backdrop-filter: blur(6px); background: rgba(255,255,255,0.8); border-bottom: 1px solid var(--border); }
    header .inner { display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 12px 16px; max-width: 1120px; margin: 0 auto; }
    .brand { font-weight: 700; font-size: 18px; }
    .search { flex: 1; display: flex; justify-content: flex-end; gap: 8px; }
    .search input { width: 100%; max-width: 520px; border: 1px solid var(--border); border-radius: 12px; padding: 10px 12px; outline: none; }
    .btn { border: 1px solid var(--border); background: #fff; color: var(--text); border-radius: 12px; padding: 10px 14px; cursor: pointer; }
    .btn:hover { background: #f9fafb; }
    .btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
    .btn.primary:hover { background: var(--primary-hover); }
    .badge { position: absolute; right: -8px; top: -8px; background: var(--primary); color: #fff; border-radius: 999px; padding: 2px 6px; font-size: 12px; font-weight: 700; }

    /* Tabs */
    .tabs { display: flex; gap: 8px; overflow-x: auto; padding: 8px 0; }
    .tab { border: 0; background: #eef2ff; color: #374151; border-radius: 999px; padding: 8px 12px; cursor: pointer; font-size: 14px; }
    .tab.active { background: #111827; color: #fff; }

    /* Coords */
    .coords { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .coord { display: flex; align-items: center; gap: 8px; background: var(--card); padding: 10px 12px; border: 1px solid var(--border); border-radius: 12px; }
    .coord span { width: 16px; color: var(--muted); font-size: 14px; }
    .coord input { flex: 1; border: 1px solid var(--border); border-radius: 10px; padding: 8px 10px; }
    @media (max-width: 640px) { .coords { grid-template-columns: 1fr; } }

    /* Drone status */
    .status { display: flex; align-items: center; justify-content: space-between; border: 1px solid var(--border); background: var(--card); border-radius: 16px; padding: 12px; margin-top: 12px; }
    .dot { width: 8px; height: 8px; border-radius: 999px; margin-right: 6px; display: inline-block; background: #9ca3af; }
    .dot.ok { background: var(--ok); }
    .status .right span { color: var(--muted); font-size: 14px; }
    .status .right b { color: var(--text); }

    /* Menu grid */
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding-bottom: 96px; }
    @media (max-width: 960px) { .grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px) { .grid { grid-template-columns: 1fr; } }

    .card { overflow: hidden; border: 1px solid var(--border); border-radius: 20px; background: var(--card); box-shadow: 0 1px 2px rgb(0 0 0 / 0.04); display: flex; flex-direction: column; }
    .card .image { position: relative; width: 100%; padding-top: 75%; overflow: hidden; }
    .card img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; transition: transform .3s; }
    .card:hover img { transform: scale(1.05); }
    .card .body { padding: 12px; display: grid; gap: 6px; }
    .card .title { font-weight: 700; }
    .muted { color: var(--muted); font-size: 14px; }

    /* Floating cart button */
    #float-cart { position: fixed; right: 24px; bottom: 24px; z-index: 30; border-radius: 999px; padding: 12px 16px; box-shadow: 0 8px 24px rgba(0,0,0,.12); }

    /* Drawer */
    .drawer-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.4); opacity: 0; pointer-events: none; transition: opacity .2s; }
    .drawer { position: fixed; top: 0; right: 0; height: 100%; width: 100%; max-width: 420px; background: #fff; transform: translateX(100%); transition: transform .25s; box-shadow: -8px 0 24px rgba(0,0,0,.1); display: flex; flex-direction: column; }
    .drawer.open { transform: translateX(0); }
    .drawer-backdrop.open { opacity: 1; pointer-events: auto; }
    .drawer .head { display: flex; align-items: center; justify-content: space-between; padding: 12px; border-bottom: 1px solid var(--border); }
    .drawer .content { padding: 12px; overflow: auto; flex: 1; }
    .drawer .foot { padding: 12px; border-top: 1px solid var(--border); }
    .cart-item { display: flex; gap: 12px; }
    .cart-item img { width: 64px; height: 64px; object-fit: cover; border-radius: 10px; }
    .qty { display: inline-flex; align-items: center; gap: 8px; }
    .qty button { width: 28px; height: 28px; border-radius: 8px; border: 1px solid var(--border); background: #fff; cursor: pointer; }
    .remove { color: var(--danger); background: transparent; border: 0; cursor: pointer; }
    .subtotal { display: flex; align-items: center; justify-content: space-between; font-weight: 700; margin-bottom: 8px; }

    /* Toasts */
    #toasts { position: fixed; right: 16px; top: 16px; z-index: 60; display: grid; gap: 8px; }
    .toast { background: rgba(0,0,0,.85); color: #fff; padding: 10px 12px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.18); }
  </style>
</head>
<body>
  <header>
    <div class="inner">
      <div class="brand">Order Drone Delivery</div>
      <div class="search">
        <input id="search" type="text" placeholder="商品を検索…" aria-label="商品検索" />
        <button id="open-cart" class="btn" aria-label="カートを開く" style="position:relative">
          カート
          <span id="cart-badge" class="badge" hidden>0</span>
        </button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="tabs" role="tablist" aria-label="カテゴリ">
      <button class="tab active" data-cat="all" role="tab" aria-selected="true">すべて</button>
      <button class="tab" data-cat="western" role="tab" aria-selected="false">洋食</button>
      <button class="tab" data-cat="rice" role="tab" aria-selected="false">ごはん</button>
    </div>

    <div style="margin:8px 0 4px; font-weight:600; color:#374151">配達座標</div>
    <div class="coords" aria-label="配達座標入力">
      <label class="coord"><span>X</span><input id="coord-x" type="number" step="0.1" value="10" /></label>
      <label class="coord"><span>Y</span><input id="coord-y" type="number" step="0.1" value="10" /></label>
      <label class="coord"><span>Z</span><input id="coord-z" type="number" step="0.1" value="0.5" /></label>
    </div>

    <div class="status" aria-live="polite">
      <div><span id="conn-dot" class="dot"></span><span id="conn-text" class="muted">Connecting...</span></div>
      <div class="right">
        <span>Drone状態: <b id="st-text">-</b></span>
        <span style="margin-left:12px">ETA: <b id="eta-text">-</b></span>
      </div>
    </div>

    <section id="menu" class="grid" aria-label="メニュー一覧"></section>
  </main>

  <button id="float-cart" class="btn" aria-label="カートを見る">カートを見る</button>

  <!-- Drawer -->
  <div id="drawer-backdrop" class="drawer-backdrop"></div>
  <aside id="drawer" class="drawer" aria-label="カート">
    <div class="head">
      <b>カート</b>
      <button id="close-cart" class="btn">閉じる</button>
    </div>
    <div id="cart-list" class="content"></div>
    <div class="foot">
      <div class="subtotal"><span>小計</span><span id="subtotal">¥0</span></div>
      <button id="checkout" class="btn primary" disabled>注文を確定する</button>
      <div id="order-note" class="muted" style="margin-top:6px; display:none">配達中は次の注文を送信できません。</div>
    </div>
  </aside>

  <div id="toasts" aria-live="polite" aria-atomic="true"></div>

  <script>
    // ---------------------- データ ----------------------
    const ITEMS = [
      { id: 'omurice', name: 'ふわとろオムライス', description: '特製デミグラスソースの王道オムライス', price: 900, image: 'https://assets.st-note.com/img/1673688281138-KdNC3j9fcg.jpg?width=1200', rating: 4.6, deliveryTime: '20-30分', category: 'western'},
      { id: 'hamburg', name: '肉厚ハンバーグ', description: 'ジューシーでボリューム満点の手ごねハンバーグ', price: 1100, image: 'https://obentodeli.jp/user/9/4/8/5/2052/205219778_pic1.jpg?20250210175116?20250210175116?20250210175116', rating: 4.7, deliveryTime: '25-35分', category: 'western'},
      { id: 'onigiri', name: '三種おにぎりセット', description: '鮭・梅・昆布の人気三種を食べ比べ', price: 600, image: 'data:image/jpeg;base64,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', rating: 4.4, deliveryTime: '15-25分', category: 'rice' }
    ];

    // ---------------------- 状態 ----------------------
    let activeCategory = 'all';
    let searchQuery = '';
    const cart = new Map(); // id -> { item, quantity }
    let orderSent = false;

    const coords = { x: 10, y: 10, z: 0.5 };

    // ---------------------- ユーティリティ ----------------------
    const JPY = n => new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format(n);
    function toast(msg) {
      const wrap = document.getElementById('toasts');
      const el = document.createElement('div');
      el.className = 'toast';
      el.textContent = msg;
      wrap.appendChild(el);
      setTimeout(() => { el.style.opacity = '0'; }, 2200);
      setTimeout(() => { wrap.removeChild(el); }, 2600);
    }

    function $(sel) { return document.querySelector(sel); }

    // ---------------------- 検索・タブ ----------------------
    $('#search').addEventListener('input', (e) => { searchQuery = e.target.value.trim().toLowerCase(); renderMenu(); });
    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeCategory = btn.dataset.cat;
        renderMenu();
      });
    });

    // ---------------------- 座標 ----------------------
    $('#coord-x').addEventListener('input', e => coords.x = parseFloat(e.target.value) || 0);
    $('#coord-y').addEventListener('input', e => coords.y = parseFloat(e.target.value) || 0);
    $('#coord-z').addEventListener('input', e => coords.z = parseFloat(e.target.value) || 0);

    // ---------------------- メニュー描画 ----------------------
    function filterItems() {
      return ITEMS.filter(it => (activeCategory === 'all' || it.category === activeCategory))
                  .filter(it => !searchQuery || it.name.toLowerCase().includes(searchQuery) || it.description.toLowerCase().includes(searchQuery) || it.restaurant.toLowerCase().includes(searchQuery));
    }

    function renderMenu() {
      const wrap = $('#menu');
      wrap.innerHTML = '';
      const items = filterItems();
      items.forEach(it => {
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <div class="image"><img src="${it.image}" alt="${it.name}" loading="lazy"></div>
          <div class="body">
            <div style="display:flex;justify-content:space-between;gap:8px;align-items:flex-start">
              <div class="title">${it.name}</div>
              <div style="font-weight:700">${JPY(it.price)}</div>
            </div>
            <div class="muted">${it.description}</div>
            <div class="muted" style="display:flex;gap:8px;align-items:center">
              <span>⭐ ${it.rating.toFixed(1)}</span><span>・</span><span>${it.deliveryTime}</span>
            </div>
            <button class="btn primary add">カートに追加</button>
          </div>`;
        card.querySelector('.add').addEventListener('click', () => addToCart(it));
        wrap.appendChild(card);
      });
    }

    // ---------------------- カート ----------------------
    const cartBadge = $('#cart-badge');
    const subtotalEl = $('#subtotal');
    const orderNote = $('#order-note');
    const checkoutBtn = $('#checkout');

    function cartCount() {
      let s = 0; cart.forEach(v => s += v.quantity); return s;
    }
    function cartTotal() {
      let s = 0; cart.forEach(v => s += v.quantity * v.item.price); return s;
    }

    function syncCartBadge() {
      const c = cartCount();
      if (c > 0) { cartBadge.hidden = false; cartBadge.textContent = c; }
      else { cartBadge.hidden = true; cartBadge.textContent = '0'; }
    }

    function renderCart() {
      const list = $('#cart-list');
      list.innerHTML = '';
      if (cart.size === 0) {
        const p = document.createElement('p'); p.className = 'muted'; p.textContent = 'カートは空です。'; list.appendChild(p);
      } else {
        cart.forEach(({ item, quantity }) => {
          const li = document.createElement('div');
          li.className = 'cart-item';
          li.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <div style="flex:1;min-width:0">
              <div style="display:flex;justify-content:space-between;gap:8px">
                <div>
                  <div style="font-weight:600" class="truncate">${item.name}</div>
                  <div class="muted">${JPY(item.price)}</div>
                </div>
                <button class="remove">削除</button>
              </div>
              <div style="margin-top:8px" class="qty">
                <button class="dec">−</button>
                <span class="count">${quantity}</span>
                <button class="inc">＋</button>
              </div>
            </div>`;
          li.querySelector('.remove').addEventListener('click', () => removeItem(item.id));
          li.querySelector('.dec').addEventListener('click', () => updateQty(item.id, Math.max(0, quantity - 1)));
          li.querySelector('.inc').addEventListener('click', () => updateQty(item.id, quantity + 1));
          list.appendChild(li);
        });
      }
      subtotalEl.textContent = JPY(cartTotal());
      checkoutBtn.disabled = (cart.size === 0) || orderSent;
      orderNote.style.display = orderSent ? 'block' : 'none';
      syncCartBadge();
    }

    function addToCart(item) {
      const v = cart.get(item.id) || { item, quantity: 0 };
      v.quantity += 1;
      cart.set(item.id, v);
      toast(`${item.name}をカートに追加しました`);
      renderCart();
    }
    function updateQty(id, qty) {
      if (!cart.has(id)) return;
      if (qty <= 0) { cart.delete(id); toast('商品をカートから削除しました'); }
      else { const v = cart.get(id); v.quantity = qty; cart.set(id, v); }
      renderCart();
    }
    function removeItem(id) { if (cart.has(id)) { cart.delete(id); toast('商品をカートから削除しました'); renderCart(); } }

    // Drawer open/close
    const drawer = $('#drawer');
    const backdrop = $('#drawer-backdrop');
    function openCart() { drawer.classList.add('open'); backdrop.classList.add('open'); renderCart(); }
    function closeCart() { drawer.classList.remove('open'); backdrop.classList.remove('open'); }
    $('#open-cart').addEventListener('click', openCart);
    $('#float-cart').addEventListener('click', openCart);
    $('#close-cart').addEventListener('click', closeCart);
    backdrop.addEventListener('click', closeCart);

    // ---------------------- WebSocket（①仕様） ----------------------
    const connDot = $('#conn-dot');
    const connText = $('#conn-text');
    const stText = $('#st-text');
    const etaText = $('#eta-text');

    let ws;
    function connectWS() {
      try { ws = new WebSocket(`ws://${location.host}/Order/ws`); } catch (e) { console.error(e); return; }
      ws.onopen = () => { connText.textContent = 'Connected'; connDot.classList.add('ok'); };
      ws.onclose = () => { connText.textContent = 'Disconnected'; connDot.classList.remove('ok'); };
      ws.onerror = () => { connText.textContent = 'Error'; connDot.classList.remove('ok'); };
      ws.onmessage = (msg) => {
        try {
          const data = JSON.parse(String(msg.data));
          const s = data && data.state;
          if (s) {
            stText.textContent = s.status ?? '-';
            etaText.textContent = (typeof s.eta === 'number') ? `${s.eta.toFixed(1)}s` : '-';
            if (orderSent && s.status === '待機中') {
              orderSent = false;
              toast('配達が完了しました。次の注文が可能です。');
              renderCart();
            }
          }
        } catch (e) {
          console.warn('WS parse error', e);
        }
      };
    }
    connectWS();

    // ---------------------- Checkout（①仕様: /register_order） ----------------------
    $('#checkout').addEventListener('click', async () => {
      if (orderSent) { toast('配達中のため次の注文は送信できません'); return; }
      // ①のAPIに合わせて3品の数量を抽出
      const qty = id => (cart.get(id)?.quantity || 0);
      const omurice = qty('omurice');
      const hamburg = qty('hamburg');
      const onigiri = qty('onigiri');
      if (omurice + hamburg + onigiri === 0) { toast('料理を選択してください'); return; }

      const payload = { omurice, hamburg, onigiri, coords };
      try {
        const res = await fetch('/register_order', {
          method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data.error || 'サーバーエラー');
        orderSent = true;
        cart.clear();
        renderCart();
        toast(`注文登録完了 ID: ${data.order_id ?? '-'}`);
        closeCart();
      } catch (e) {
        console.error(e);
        toast('エラー: ' + (e.message || e));
      }
    });

    // 初期描画
    renderMenu();
    renderCart();
  </script>
</body>
</html>